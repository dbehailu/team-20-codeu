
<!--
Copyright 2019 Google Inc.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
    http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Waldo</title>
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="stylesheet" href="/css/main.css">
    <script src="/js/navigation-loader.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<!--     <script src="/js/text-to-speech.js"></script> -->
    <script>
      function formatDate(date) {
        var hours = date.getHours();
        var minutes = date.getMinutes();
        var ampm = hours >= 12 ? 'pm' : 'am';
        hours = hours % 12;
        hours = hours ? hours : 12; // the hour '0' should be '12'
        minutes = minutes < 10 ? '0'+minutes : minutes;
        var strTime = hours + ':' + minutes + ' ' + ampm;
        return date.getMonth()+1 + "/" + date.getDate() + "/" + date.getFullYear() + "  " + strTime;
      }

      function runQuery() {
        //const div = document.getElementById('lostDiv');
        const div = document.getElementById('message-container-0');
        while(div.firstChild){
            div.removeChild(div.firstChild);
        }
        // var addDiv = document.createElement('div');
        // addDiv.setAttribute('id', `message-container-0`);
        // document.getElementById('lostDiv').appendChild(addDiv);
         messageContainer = document.getElementById(`message-container-0`);
        // messageContainer.classList.add('message-container');
        var query=document.getElementById('lostInput').value.toLowerCase();

        const url = '/feed';
        fetch(url).then((response) => {
          return response.json();
        }).then((messages) => {
          // var counter = 0;
          // var divCount = 0;
          if(messages.length == 0){
           messageContainer.innerHTML = '<p>There are no posts yet.</p>';
          }
          else{
           messageContainer.innerHTML = '';  
          }
          //var counter = 0;
          messages.forEach((message) => {  
            if (message.text.toLowerCase().indexOf(query) != -1) {
              const messageDiv = buildSummaryDiv(message);
              // if (counter % 3 == 0 && counter != 0) {
              //   divCount++;
              //   var addDiv = document.createElement('div');
              //   addDiv.setAttribute('id', `message-container-${divCount}`);
              //   document.getElementById('lostDiv').appendChild(addDiv);
                
              // }
              messageContainer = document.getElementById(`message-container-0`);
              //messageContainer.classList.add('message-container');
              messageContainer.appendChild(messageDiv);
              //counter++;
              
            }
           
          });
        });


      }

        // Fetch messages and add them to the page.
      function fetchMessages(){
        runQuery();
      }
  
      function buildSummaryDiv(message){
        //  const usernameDiv = document.createElement('div');
        //  usernameDiv.classList.add("left-align");
        //  usernameDiv.appendChild(document.createTextNode(message.user));
         
        //  const timeDiv = document.createElement('div');
        //  timeDiv.classList.add('right-align');
        //  timeDiv.appendChild(document.createTextNode(new Date(message.timestamp)));
         
        //  const headerDiv = document.createElement('div');
        //  headerDiv.classList.add('message-header');
        //  headerDiv.appendChild(usernameDiv);
        //  headerDiv.appendChild(timeDiv);

        // //placeholder
        //   const bodyDiv = document.createElement('div');

        //   bodyDiv.insertAdjacentHTML('beforeend', message.text);
        //   bodyDiv.classList.add('message-body');
         
         
        //  const messageDiv = document.createElement('div');
        //  messageDiv.classList.add("message-div");
        //  messageDiv.appendChild(headerDiv);
        //  messageDiv.appendChild(bodyDiv);

        const cardWrap = document.createElement('div');
        cardWrap.classList.add("card-wrap");
        cardWrap.classList.add("hover");

        const card = document.createElement('div');
         card.classList.add("card-lost");
         
         
         const timeDiv = document.createElement('div');
         timeDiv.classList.add('inner-wrapper');
         timeDiv.appendChild(document.createElement("H2").appendChild(document.createTextNode(formatDate(new Date(message.timestamp)))));
         timeDiv.appendChild(document.createElement("br"));
         timeDiv.appendChild(document.createElement("br"));
         timeDiv.appendChild(document.createElement("p").appendChild(document.createTextNode(message.user)));
         var line = document.createElement("hr");
         line.classList.add("line");
         timeDiv.appendChild(line);

         const cardInfo = document.createElement('div');
         cardInfo.insertAdjacentHTML('beforeend', message.text);

         card.appendChild(timeDiv);
         card.appendChild(cardInfo);

        // const back = document.createElement('div');
        // back.classList.add("back");
        // cardInfo.insertAdjacentHTML('beforeend', message.image);

         cardWrap.appendChild(card);
         // cardWrap.appendChild(back);

         return cardWrap;
      }

      /** Fetches users and adds them to the page. */
      function fetchUserList(){
        const url = '/user-list';
        fetch(url).then((response) => {
          return response.json();
        }).then((users) => {
          const list = document.getElementById('list');
          list.innerHTML = '';

          users.forEach((user) => {
           const userListItem = buildUserListItem(user);
           list.appendChild(userListItem);
          });
        });
      }

      /**
       * Builds a list element that contains a link to a user page, e.g.
       * <li><a href="/user-page.html?user=test@example.com">test@example.com</a></li>
       */
      function buildUserListItem(user){
        const userLink = document.createElement('a');
        userLink.setAttribute('href', '/user-page.html?user=' + user);
        userLink.appendChild(document.createTextNode(user));
        const userListItem = document.createElement('li');
        userListItem.appendChild(userLink);
        return userListItem;
      }

      /** Fetches data and populates the UI of the page. */
      function buildUI(){
       //fetchUserList();
       fetchMessages();
      }
    </script>
  </head>
  <body onload="addLoginOrLogoutLinkToNavigation(); buildUI();">
    <h1 id="titleHeader">WALDO</h1>
    <nav>

      <ul id="navigation">
        <li><a href="/">Home</a></li>
        <li><a href="/aboutus.html">About</a></li>
        <li>
          <form onsubmit="runQuery(); return false;" method="">
            <div class="container">
              <input id="lostInput" type="text" class="input" placeholder="What did you lose?">
              <input type="submit" value="search" class="submit-btn btn btn-primary">
            </div>
          </form>
          
        </li>
      </ul>
    </nav>

<!--     <figure>
      <figcaption>Try out Text-To-Speech:</figcaption>
      <audio id="audio-" src=""></audio>
      <button type="button" onclick="doTTS();">Play</button>

      <p>
        <label>Text Area</label>
        <textarea id = "myText"
                  rows = "3"
                  cols = "80">Your text here
        </textarea>
      </p>
    </figure> -->

    <div id="contentDiv">



      <!-- <div   id = "intro">
        placeholder
      </div>

       -->

      <div id="lostDiv">
<!--         <h3 id="titleHeader">LOST ITEMS</h3> -->
        <div class = "message-container" id="message-container-0" style="box-sizing:border-box">Loading...</div>
      </div>

      <!-- <div   id = "actives">Active Users:
        <ul id="list">Loading...</ul>
      </div> -->
      
    </div>


  </body>
</html>